# Computer Network <Badge text="alpha" type="warn"/> <Badge text="4.11.2"/>

## 1 概述

### 1.1 互联网的组成

1. 边缘部分
   1. C/S 包含 B/S
   2. P2P
2. 核心部分
   由路由器连接，进而实现分组交换

### 1.2 各种交换的特点

1. 电路交换
   在通话的全部时间内，童话的两个用户始终占用端到端的通信资源
2. 分组交换
   1. 数据报
      易于重复或者丢失 但由于易于搭建 所以采用的更多
   2. 虚电路
      类似于地图的路线规划，同一链路可属于多个虚电路，不独占物理线路
      -  虚电路携带数据：
         1. 路径
         2. 编号
         3. 路由表
      -  分组 HEAD 携带编号

-  虚电路与电路交换的比较：
   虚电路是逻辑连接，非专用，每个结点到其他结点可有无数虚电路

### 1.3 计算机网络的性能

#### 1.3.1 计算机的性能指标

1. 速率
2. 带宽
   频带宽度，数字信道所能传送的“最高数据率”
3. 吞吐量
   单位时间通过某个网络的数据量，受制于网络带宽和额定速率，也即其为实际值，带宽速率为额定值
   另外其取决于整个链路中吞吐量最低的链路
4. 时延
   1. 发送时延
      数据帧长度/发送速率
   2. 传播时延
      信道长度/电磁波在信道的传播速率
   3. 处理时延
      存储转发
   4. 排队时延
      队列等待，与网络中当前数据量相关
      每增加一个中间 Node 就会增加一个发送时延
5. 时延带宽积
   传播时延 x 带宽
   第一个分组到达下一个节点时候信道内的数据
6. 利用率
   利用率过高会产生非常大的时延

### 1.4 网络计算研究与应用的发展

### 1.5 计算机网络的体系结构

#### 1.5.1 网络协议的概念

三要素：语法 语义 时序

#### 1.5.2 网络体系结构的研究方法

1. 层次 （layer）
2. 接口（interface）
3. 各层要完成的功能
   1. 差错控制
   2. 流量控制
   3. 分段和重装
   4. 复用和分用
   5. 连接建立和释放
      分层**缺点**：**同一功能会在不同的层次中重复出现**

#### 1.5.3 层次模型

路由器只实现到网络层

1. OSI 七层协议
2. TCP/IP 四层协议
3. 五层协议
   1. 物理层（physical layer)
      bit
   2. 数据链路层 （data link layer）
      frame(帧) 差错检测
   3. 网络层 （network layer）
   4. 传输层 （transport layer）
      端到端 检测数据包错误和次序
   5. 应用层 （application layer）
      > 每层不需要知道下一层的细节

## 2 物理层

### 2.1 基本概念

#### 2.1.1 数据（Data）

#### 2.1.2 信号（Signal）

1. 模拟信号
2. 数字信号

### 2.2 数据传输类型与通信方式

-  基本问题

1. 类型
   1. 模拟通信
   2. 数字通信
2. 通信方式
   1. 串行 并行
   2. 单工 全双工 半双工
3. 同步方式
   1. 同步 为解决时钟频率问题可以让发送方发送时钟脉冲，更好的方法是采用曼彻斯特编码
   2. 异步
      以字符为单位传输，前后分别加起始位和停止位

#### 2.1.3 传输介质的主要类型

-  有线传输介质
   1. 双绞线
   2. 同轴电缆
   3. 光纤
-  无线传输介质
   1. 无线电波
   2. 微波
   3. 卫星

### 2.2 物理层与物理层协议的基本概念

通信子网分为：点对点与广播信道
广域网主要用点对点，城域网与局域网主要用广播

### 2.3 数据编码技术

#### 2.3.1 数字数据的模拟信号

1. 幅移键控
2. 频移键控
3. 相移键控

#### 2.3.2 数字数据的数据信号

1. 非归零码
2. 曼彻斯特编码 优点：本身携带时钟周期；消除直流分量 缺点：频率增加一倍，导致失真会严重，需要降低信道容量，原理参见 2.4.2-1
3. 差分曼彻斯特编码

#### 2.3.3 模拟数据的数字信号

脉冲编码调制（PCM） 采样量化编码

### 2.4 基带传输技术

#### 2.4.1 基带传输的定义

脉冲波可以由傅里叶展开，分布在各个频率上

#### 2.4.2 信道的极限容量

1. 带宽
   如果不限制的增大频率，那么傅里叶展开的高频分量便增多，在信道上会被过滤掉的也更多，失真很大，很难恢复
2. 信噪比
   香农公式 指出了**信道的极限信息传输速率**

### 2.5 多路复用技术

#### 2.5.1 时分复用

如果某个结点没有数据需要发送，那么信道资源会浪费
这就衍生出来统计时分多路复用，需要增加标识 ID（地址）

#### 2.5.2 频分复用

#### 2.5.3 波分复用

#### 2.5.4 码分复用

每个站有一个 m bit 的码片序列，各结点码片序列正交，1 传原码 0 传反码 代价：传输 m 倍数据，只能说使得信号可以分离，但并不能说效率增高了

## 3 数据链路层

解决了适配器间的交互问题，而且只在相邻结点之间

### 3.1 使用点对点信道的数据链路层

#### 3.1.1 数据链路和帧

1. 链路 无源点对点的物理线路段
2. 数据链路 物理链路+通信协议
   协议需要使用网卡

-  以**帧**为单位

#### 3.1.2 三个基本问题

1. 封装成帧
   添加首部（SOH）与尾部（EOT）以进行帧定界，数据部分小于等于 MTU
2. 透明传输
   在数据中出现的控制字符和转义字符前加转义字符（ESC），就类似 C 等中的“\”转义啦
3. 差错检测
   比特差错 利用循环冗余检验(CRC)
   帧的丢失、重复、失序并不能检测出来，故不是可靠传输

### 3.2 点对点协议 PPP

#### 3.2.1 PPP 协议的特点

1. 简单——这是首要的要求
2. 封装成帧
3. 透明性
4. 多种网络层协议
5. 多种类型链路
6. 差错检测
7. 检测连接状态
8. 最大传送单元
9. 网络层地址协商
10.   数据压缩协商

#### 3.2.2 PPP 协议不需要的功能

1. 纠错
2. 流量控制
3. 序号
4. 多点线路
5. 半双工或单工链路

#### 3.2.3 PPP 协议的组成

#### 3.2.4 PPP 协议的帧格式

1. 各字段意义
   7E FF 03 协议 信息部分 FCS 7E
2. 字符填充 用于异步传输
   增加转义字符
3. 零比特填充 用于同步传输
   一旦出现连续 5 个 1 就插入一个 0
   > 可靠传输的权衡
   > 由于出错率较低，并不需要在数据链路层完成，可交由更高层完成（比如 TCP）

#### 3.2.5 PPP 协议的工作状态

### 3.3 使用广播信道的数据链路层

#### 3.3.1 局域网的数据链路层

1. 拓扑
   1. 星型网 中央结点出问题全网瘫痪
   2. 环形网 类似链表，结点插入与删除较麻烦
   3. 总线网 较为方便，采用较多
2. 媒体共享技术
   1. **静态**划分信道
      1. 频分复用
      2. 时分复用
      3. 波分复用
      4. 码分复用
         静态，并不适合
   2. 动态媒体接入控制
      1. 随机接入
      2. 受控接入
3. 数据链路层的两个子层
   1. 逻辑链路控制 LLC
   2. 媒体接入控制 MAC
4. 适配器的作用
   1. 串并转换
   2. 数据进行缓存
   3. 需要驱动程序
   4. 实现以太网协议

#### 3.3.2 CSMA/CD 协议

1. 措施
   1. 无连接 不编号
   2. 曼彻斯特编码
2. 协议方式
   1. Aloha
   2. 信道监听
   3. 冲突后停止发送，等待随机时间后重传
      故 CSMA/CD 使用多点接入载波监听碰撞检测这样的协议
3. 重要特性
   1. 半双工
4. 争用期 2τ(51.2μs)
   重传以 2τ 为单位，从$0~2^k-1$选一个数
5. 帧间最小间隔 9.6μs
6. 强化碰撞 人为干扰信号

#### 3.3.3 以太网的信道利用率

1. 减小 τ
2. 增大帧长，但不能超过 MTU

#### 3.3.4 以太网的 MAC 层

1. MAC 层的硬件地址
   固化在适配器 ROM 中
   前 24 位为厂家标志，后 24 位厂家自行分配 适配器对帧进行检查
2. MAC 帧的格式
   目的地址 源地址 类型 数据(46-1500B) FCS
   > 没特别做透明传输机制的原因：
       1 曼彻斯特编码，可识别有无信号
       2 帧间有间隔
3. 无效的 MAC 帧 丢掉就好(╯‵□′)╯︵┻━┻

### 3.4 扩展的局域网

#### 3.4.1 在物理层扩展以太网

利用集线器互连，但使得碰撞域也更大了，吞吐量并未提高，而且需要各碰撞域使用相同数据率

#### 3.4.2 在数据链路层扩展以太网

**网桥**

1. 内部结构
   **网桥的接口就是结点**
   没有扩展碰撞域，用户独占带宽 1. 优点 1. 用户独占带宽 2. 可以使用不同数据率 2. 缺点 1. 存储转发时延 2. 无流量控制 3. 广播风暴
2. 透明网桥
   1. 利用**自学习算法**，可以根据帧的源地址和来源接口建立表，同时记录一个有效时间，以保证各结点变化时可以继续正常工作
   2. 使用生成树算法避免兜圈子
3. 以太网交换机
   1. 就是多接口的网桥，每个接口都直接与主机相连，一般是全双工
   2. 星型拓扑，不需要 CSMA/CD，不需要竞争资源，效率更高

### 3.5 无线局域网(WLAN)

#### 3.5.1 无线局域网的组成

1. 基本服务集 BSS
2. 接入点 AP
3. 扩展的服务集 ESS

-  与接入点 AP 建立关联

   -  被动扫描
   -  主动扫描

-  常用 802.11 无线局域网

#### 3.5.2 无线局域网标准 IEEE 802.11

1. 帧间间隔 IFS 根据优先级设置帧间间隔，高优先级帧间间隔短，最短的间隔大于端到端时延
2. 链路层确认
   CRC 校验，并返回确认帧，若未收到则重传
3. CSMA/CA 协议
   因为无法检测碰撞，故使用**退避算法**以降低碰撞几率
   只有第一帧且信道空闲不执行退避算法，此外全部需要使用退避算法
4. 解决隐蔽站和暴露站问题
   1. 虚拟载波监听
   2. 想发送数据前先发送 RTS（包含时间），接受站发送 CTS（包含时间）
   3. 短数据帧代价有点大，不使用也可
5. 802.11 局域网的 MAC 帧
   1. 数据帧
      1. 要有序号，以配合确认机制
      2. 除去传输帧站点 MAC 和接收帧站点 MAC，还需要一个真正的源地址或者目的地址（emmmm，也不一定，有路由器的话就不是真正的咯）
      3. 没有冲突检测，故数据部分不需要够 46 字节
      4. 分片机制，不限制 MTU 可以增加灵活性，在信道质量好的时候可以传输长一些，而质量差的时候进行分片传输短的数据帧；整个帧的占用时间是所有分片占用时间的加和
   2. 控制帧
   3. 管理帧

## 4 网络层

### 4.1 网络层提供的两种服务

数据报或者虚电路

> 有人按照电信网提出了虚电路的方法，这就需要提前建立链路，之后就可以进行比较可靠的传输了，但是计算机网络其实是有着很强的差错处理能力的，所以它并不需要过高的可靠性，可将错误处理等任务交由上层处理，这样有一个好处就是大大提升了网络层的灵活性

#### 4.1.1 虚拟互联网络

因为各个网络间有着各种各样的协议等等问题，而要做到各个网络标准完全一致又是不可能的，因此网络之间的互连就成了一个问题

一般来说，各层间的中间设备分别是：

-  物理层： 转发器
-  数据链路层： 网桥
-  网络层： 路由器
-  网络层以上： 网关

由于我们讨论的是网络层，所以在该层上看，转发器与网桥对网络的互连其实仅仅是将一个网络扩大了，还是在一个网络上；所以我们讨论网络的互连一般指路由器对网络的互连

### 4.2 IP 地址

#### 4.2.1 地址结构

网络号+主机号，可加快转发效率

#### 4.2.2 分类

根据前几位可分为 5 类
A 类 0
B 类 10
C 类 110
D 类 1110 多播
E 类 1111 保留

#### 4.2.3 RFC 保留的地址

专用网络内 专有或私有的地址块

#### 4.2.4 网络接口与 IP 地址的关系

每个接口都有 IP

#### 4.2.5 IP 地址的一些重要特点

1. 是一种分等级的地址结构
2. 每个接口都有一个 IP，所以，有多个接口接入网络的主机会是多归属主机
3. 用转发器或者网桥互连是在同一个网络，路由器才能连接不同网络
4. 同一网络号所有 IP 是平等的

#### 4.2.6 子网和超网的基本概念

传统的分配方法会造成 IP 地址的浪费

1. 子网 将大的网络分成几个较小的网络 IP = 网络号 + 子网号 + 主机号
   1. 由于从 IP 数据报中无法知道该主机所连接的网络是否进行子网划分，所以使用子网掩码对 IP 地址的子网部分进行标记
   2. 网络号与子网号均置 1，主机号置 0
   3. 判断两主机是否在同一子网，只需要 IP 与子网掩码与运算就好啦，但是两个结点的子网掩码不同可能导致判断不同的，所以可能会出现 A 认为 B 和自己在同一子网，而 B 认为 A 和自己不在同一子网的情况
2. 超网 无分类域间路由 CIDR
   1. 不进行 ABC 的分类，只需要网络前缀即可(相当于只有子网掩码)
   2. 可利用斜线记法表示，对应掩码 1 的个数
   3. 路由聚合（路由聚合有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能）

#### 4.2.7 专用 IP 地址与网络地址转换 NAT 技术

-  专用 IP 地址仅仅在机构内部使用，是不可能出现在网络上的

   -  三个专用 IP 地址块：

      -  10.0.0.0 - 10.255.255.255
      -  172.16.0.0 - 172.31.255.255
      -  192.168.0.0 - 192.168.255.255

   -  虚拟专用网 VPN

      利用公用的互联网作为本机构各专用网之间的通信载体，由于通过公用的互联网，所以数据必须加密

      利用隧道技术（通过公用网的时候，将专用网内 IP 数据报封装入数据部分，首部写入公网 IP 等信息）

      ![CN02](../Images/CN02.png)

-  路由器上有一个 IP 的转换表，在传输层有对**端口号**的管理，从而确定路由器发送到哪个内部结点

### 4.3 网际协议 IP

#### 4.3.1 IP 数据报结构

版本 首部长度 区分服务 总长度 标识 标志 片偏移 生存时间 协议 首部检验和 源地址 目的地址 可变部分

> 标识、标志、片偏移三个字段的存在可以保证分片可以正常组装，标识位区分是否是同一个帧的分片、标志标明是否使用分片和分片是否到了最后一片、片偏移标志了顺序（字节为单位）

> 低于 46 字节的填充是在网络层完成而不是数据链路层，可由总长度区分数据与填充部分

> 协议字段决定交由上层哪个协议

### 4.4 IP 层转发分组的流程

转发（forwarding）是将分组从一个输入链路接口转移到正确的输出链路端口

#### 4.4.1 默认路由（default route）

将所有未知网络聚合成一个表项

#### 4.4.2 分组转发算法

1. 首部提取目的主机 IP 地址 D，得出目的网络地址 N

```Python
N = D & Netmask
```

2. 与直接相连各网络地址匹配

```Python
if D in Adjacent:
    直接交付
    break
else:
    间接交付(call(3))
```

3. 特定主机路由匹配

```Python
if D in route:
    送至下一跳路由
    break
else:
    call(4)
```

4. 网络匹配

```Python
if N in route:
    送至下一跳路由
    break
else:
    call(5)
```

5. 默认路由

```Python
if hasDefaultRoute:
    送至默认路由器
    break
else:
    call(6)
```

6. 报告转发分组出错

```Python
raise IPError
```

> 如果多项匹配，那么按照匹配的更多的进行转发（子网），这样转发是最优的路径

### 4.5 地址解析

IP 地址与硬件地址

#### 4.5.1 ARP 协议

解决**同一个局域网**上的主机或路由器的 IP 地址和硬件地址的映射问题
源结点喊（请求，广播帧）一下 IPxxx 的是谁，目的结点把他的 Mac 地址反馈（应答，单播即可）过去，然后生成一张表，另外有一个更新时间戳，以便更新

#### 4.5.2 为何不用硬件地址通信

因为网络发展初期，硬件地址格式并不统一

#### 4.5.3 Examples

-  AB 经网桥互连
   源 IP|目的 IP|源 MAC|目的 MAC
   ---|---|---|---
   A|B|A|B
   A|B|A|B
-  AB 经路由器相连
   源 IP|目的 IP|源 MAC|目的 MAC
   ---|---|---|---
   A|B|A|router
   A|B|router|B

#### 4.5.4 Others

ARP 只经过链路层，不经过网络层封装

### 4.6 网际控制报文协议 ICMP

用来提高交付成功的机会，它允许主机或路由器报告差错情况和提供有关异常情况的报告

#### 4.6.1 ICMP 的种类

-  ICMP 差错报告报文 收到有问题的报文的主机或路由器向源主机或路由器发送
   -  终点不可达
   -  时间超过
   -  参数问题
   -  改变路由（重定向）
-  ICMP 询问报文
   -  回送请求和回答
   -  时间戳请求和回答

#### 4.6.2 ICMP 应用举例

-  `ping`
-  `traceroute`(UNIX) 、 `tracert`(Windows)

### 4.7 路由器

最高处理到网络层

#### 4.7.1 输入到输出

打碎，重构网络层首部；相对的，网桥并不打碎链路层首位部

#### 4.7.2 交换结构

将分组从一个输入端口转移到正确的输出端口

1. 内存读写 需要解决内存读写速度
2. 总线结构 需要解决总线的竞争
3. 互联网络 crossbar 可多个端口同时输出

#### 4.7.3 分组丢弃

1. 当输入侧带宽较高时，路由器处理速率较低，将会导致输入侧缓存满，无法继续存入分组，只能丢弃
2. 当采用一定的加速比时，输出侧处理速度无法与输出侧处理速度相匹配，输出侧缓存满，也会导致分组被丢弃

### 4.8 Internet 的路由选择协议

#### 4.8.1 路由算法分类

-  全局性/分布式
-  静态路由选择策略/动态路由选择策略

#### 4.8.2 分层次的路由选择协议

因特网采用分层次的路由选择协议

#### 4.8.3 自治系统 AS

在相同管理控制下的一组路由器

-  内部网关协议 IGP
   -  RIP
   -  OSPF
-  外部网关协议 EGP
   -  BGP

#### 4.8.4 内部网关协议 RIP

1. 分布式 距离向量
2. 路由表的建立
   -  开始只知道相邻的路由信息（距离为 1）
   -  每个路由器只和相邻路由器交换并更新路由信息
   -  若干次更新后……该自制系统的路由信息就都知道了
   -  RIP 协议收敛过程比较慢
3. RIP 的工作过程
   -  收到相邻路由器的路由表，将*该路由表*的下一跳更新，距离加一，该更新是无条件的（因为这不是最终的路由表，更新保证了时效性）
   -  与自己的路由表比较，小则替换，大则 pass
   -  若 3min 收不到该路由器的路由表，则判断该路由器宕掉了
4. 三个要点
   -  相邻路由器交换
   -  交换的信息是当前路由器所知道的*全部信息*
   -  按固定的时间间隔交换路由信息（30s）
5. 优缺点
   1. 某个路由器的故障信息传播较慢
   2. 实现简单，开销较小
   3. 限制了网络的规模使用的最大距离为 15
   4. 路由器之间交换的路由信息是完整的路由表，随着网络规模增大，开销将会增加

#### 4.8.5 最短路径优先协议 OSPF

1. 基本特点
   -  开放
   -  最短路径优先 （ Dijkstra 算法）
   -  分布式的链路状态协议
2. 三个要点
   -  向本自治系统所有路由器发送信息
   -  发送与本路由器相邻所有路由器的链路状态（与谁相连与链路的度量（就是权重，比如带宽、时延等））
   -  只有链路状态变化时才需要更新
3. 链路状态数据库
   就是储存的拓扑结构信息
4. OSPF 的区域
   1. 如果自治系统很大，那么需要对自治系统划分为一个个区域（area）
   2. 每个区域有一个 32 位标志符（点分十进制）
   3. 区域不能太大，最好一个区域不超过 200 个路由器
   4. 两种区域：主干区域、其它
5. OSPF 直接用 IP 数据报传送
   1. 不用 UDP，直接用 IP 数据报，而 RIP 是需要先封装成 UDP 协议的
   2. 数据报很短，可减少路由信息的通信量
   3. 不需要分片
   4. 但分片传送的数据包只要丢失一个就无法组装成原来的数据报，整个数据报要重传
6. 其他特点
   1. 可以根据不同链路的类型计算不同的路由
   2. 多路径间的负载平衡
   3. 所有在 OSPF 路由器之间交换的分组都具有鉴别的功能
   4. 支持可变长度的子网划分和五分类编址 CIDR
   5. 每个链路状态都带上一个 32 位的序号
   6. OSPF 每隔一段时间要刷新链路状态
7. OSPF 的五种分组类型
   -  问候
   -  数据库描述
   -  链路状态请求
   -  链路状态更新
   -  链路状态确认
8. OSPF 的基本操作
   ![CN01](../Images/CN01.png)
   另外， OSPF 使用的是**可靠的洪泛法**发送更新分组
9. 优缺点
   -  当互联网规模很大时，OSPF 协议要比 RIP 协议好得多
   -  OSPF 没有坏消息传得慢的问题，收敛比较快

#### 4.8.6 边界网关协议 BGP

1. 使用环境

不同 AS 间的路由选择协议

> 为什么不能使用内部网关协议（RIP/OSPF）？
>
> -  互联网规模太大，使得自治系统 AS 之间的路由选择非常困难（交换完整信息需要庞大数据库，计算最短路径需花费大量时间），因此 BGP 协议使用交换“可达性”信息
> -  自治系统 AS 之间的路由选择必须考虑有关策略（考虑到政治、安全、荆棘等因素）
>
> 综合上述理由， BGP 只能是力求寻找一条**能够到达目的网络且比较好的路由**（不能兜圈子），而**并非要寻找一条最佳路由**

2. BGP 发言人

每个 AS 至少有一个 BGP 发言人（BGP speaker）

-  交换路由信息

   BGP 发言人之间建立 TCP 连接，从而交换路由信息

3. BGP 协议的特点

   -  BGP 协议交换路由信息的结点数量级是自治系统数的量级，这要比这些自治系统中的网络数少很多
   -  每一个自治系统中 BGP 发言人（或边界路由器）的数目是很少的，这样就使得自治系统之间的路由选择不致过分复杂
   -  BGP 支持 CIDR
   -  在 BGP 刚刚运行时，BGP 的邻站是交换整个的 BGP 路由表。但以后**只需要在发生变化时更新有变化的部分**，这样做对节省网络带宽和减少路由器的处理开销都有好处

4. BGP-4 的四种报文
   -  OPEN
   -  UPDATE
   -  KEEPALIVE
   -  NOTIFICATION

### 4.9 IPv6

IPv4 的 32 位地址空间已经不足，IPv6 的 128 位地址空间在可预见的未来是用不尽的

#### 4.9.1 IPv6 的基本首部

仍支持无连接的传送

主要变化：

-  更大的地址空间
-  扩展的地址层次结构
-  灵活的首部格式
-  改进的选项
-  允许协议继续扩充
-  支持即插即用（即自动配置）
-  支持资源的预分配
-  IPv6 首部改为 8 字节对齐

#### 4.9.2 IPv6 的地址

-  IPv6 的数据报的目的地址可以是以下三种基本类型地址之一

   -  单播
   -  多播
   -  任播

-  IPv6 的记法（冒号十六进制记法）：

   -  零压缩（只能进行一次）
   -  点分十进制法的后缀

#### 4.9.3 IPv4 向 IPv6 的过渡

逐步演进

-  双协议栈 部分主机（或路由器）同时装有两个协议栈（IPv4、IPv6）
-  隧道技术 当 IPv6 数据报进入 IPv4 网络时，将数据报封装成 IPv4 数据报

#### 4.9.4 ICMPv6

相当于 IPv4 中的 ICMP、IGMP、ARP 的合并版，其为面向报文的协议，利用报文来报告差错、获取信息

### 4.10 IP 多播

可以更好地支持一对多通信（向 90 个主机发送数据需要 90 次单播，如果多播只需要一次）

#### 4.10.1 网际组管理协议 IGMP

使路由器知道多播组成员的信息

1. 加入多播组

   主机向多播组的多播地址发送 IGMP 报文

2. 探询组成员变化情况

   多播路由器周期探询本地局域网上的主机，以便知道他们是否还活跃

#### 4.10.2 多播路由选择协议

使路由器和互联网上的其他多播路由器协同工作，一边宝多播数据报用最小代价传送给所有的组成员

多播路由选择实际上就是要找出以源主机为根结点的多播转发树

-  洪泛与剪除
-  隧道技术 在不支持多播的网络上加上首部重新封装后传输
-  基于核心的发现技术

### 4.11 多协议标记交换 MPLS

#### 4.11.1 MPLS 的工作原理

由于每次分组到达一个路由器后都需要抽取目的地址、查路由表后转发，所以当网络流量很大时会花费很多时间，故在 MPLS 域入口处给每个数据报打上一定长度的“标记”，之后**对打上标记的 IP 数据报使用硬件进行转发**，离开 MPLS 域时去掉标记

#### 4.11.2 MPLS 首部的位置与格式

位置在网络层与数据链路层之间，从层次的角度看，MPLS 在第二层和第三层之间

# Extends

1. wireshark 抓包工具

# Amendant Record

1. 180913 #1 Finished
2. 180918 #2 Finished
3. 181009 #3 Finished
4. 190226 #4 Finished

# Reference

1. 申彦明老师课程
2. [《计算机网络》及其配套课件 谢希仁](http://yx.51zhy.cn/net.jsp)
