# 二维有限差分法温度场模拟程序

本程序来源于材成专业必修课程 《计算机编程与实践》，使用 VB 实现铸件凝固过程温度场数值模拟程序，最低要求实现以下功能

-  前处理程序
   -  可以将指定大小区域（$0.5m \times 0.5m$）以等网格（$\Delta x = \Delta y$）进行划分
   -  并可以自定义网格属性（铸件、铸型）—— 例如可以点选赋值，参考五子棋程序
   -  可以将绘制好的网格、材料属性等相关数据导出，供后处理程序使用
-  计算及后处理程序
   -  可以接受前处理程序导出的文件，并正确显示
   -  可以设置单元初始温度、导热系数等非材料属性模拟相关参数
   -  可以计算温度场
   -  可以选择计算潜热或不计算潜热
   -  可以将温度场以云图的方式显示（设置合理的彩色温度标尺）
   -  可以输出预设点的温度曲线（设置合理的坐标）

### 依赖

-  Microsoft Common Diglog Control 6.0
-  Microsoft Windows Common Controls 5.0

前后处理程序均依赖以上部件，请保证预先装载后再使用

## 用法简述

### 前处理

#### 生成网格

根据 $\Delta x$ 与 $\Delta y$ 对网格进行划分，以便后续对材料进行设置

#### 指定材料

默认全铸型（不允许空白的存在，以保证最外圈就是边界，否则网格划分等方便需要修改）

可使用快捷键 Ctrl 、 Shift 快速选中区域，具体使用方法如下

-  按住 Ctrl 后，之前选中的区域不消失，新选中的区域会与原区域取交选中
-  按住 Shift 后，上次选中的点会作为起点，新的点作为终点，选中连续的一个矩形
-  同时按住 Ctrl 和 Shift ，emmmmm 试一下吧（反正不会爆炸:joy:）~

指定材料时可利用反向填充选项，这样就可以对未选中区域填充目标材料

#### 材料选择

程序自动会从材料文件 `data/params.dat` 中读取并填入相应列表，可以在文件中手动添加（注意单位哦！）

### 后处理

#### 参数设置

注意对时间步的计算，程序内辅助计算最大时间步（为保证足够小又乘了 0.9 ）

#### 设置探针

可通过温度探针对某个结点温度进行记录，以便后续绘制温度曲线

窗口打开后，可通过点选方式辅助选中结点，并可以选择后续是否显示探针图形（一个小靶子）

#### 计算

对后续温度场进行模拟计算，可中途暂停、继续，目前性能较低，待优化

#### 显示温度曲线

对探针处温度进行绘制，可在运行时手动刷新

鼠标在图像区域移动时，会显示该时间步下的温度值，并画出辅助线（可使用刷新按钮去掉）

## 计算公式

由于是二维，所以所有需要使用体积进行计算的地方均使用面积代替，接触面也变成了接触宽度，最后计算所得的热量单位应为 $J/m$ ，但由于单元热平衡法两侧单位一致，直接计算即可

### 有限差分法

使用单元热平衡法对 $s \times w$ 大小的微元进行分析

考察任意两个相邻结点之间的热交换，令 $s$ 为相邻两结点间的接触宽度， $w$ 为目的结点在沿两结点连线方向的厚度， $s \times w$ 应为该微元的面积（“体积”）

> 由于相邻结点之间的传热是相反的，可计算一次后传入热量缓冲矩阵，计算时间可以减半（可能后续完成，不过一般说完我都不做了:joy:）

-  从相邻结点获得的热量 $Q_k = k \frac{T' - T}{d} \cdot s \cdot \Delta \tau$
-  从空气获得的热量 $Q_h = h (T_{AIR} - T) \cdot s \cdot \Delta \tau$

故总热量 $Q$ 应为上下左右四方向传热加和

又 $Q = c m \Delta T = c \rho s w \Delta T$ ，可计算出最终的热量

### 铸件-铸型界面模型

可计算得 当量 $k$ 应为 $\frac{2 k_1 k_2}{k_1 + k_2}$ ，即 计算铸件铸型之间换热时使用该 $k$ 替换原有 $k$

### 潜热的计算

由于金属（合金）凝固时会释放潜热，会延缓结晶温度区间的温度变化，故需要一定处理手段，这里使用温度（热量）补偿法，利用潜热矩阵记录剩下的潜热

由于 $c \Delta T = L$ ，故 $Q_L = c m \Delta T = c \rho s w \Delta T$

在凝固点（液相线）下，根据潜热抵消已释放的热量部分

### 收敛判据

-  $\frac{k_M \Delta t}{c_M \rho_M d^2} \leq \frac{1}{4}$
-  $\frac{k_S \Delta t}{c_S \rho_S d^2} \leq \frac{1}{4 (1 + B)}$

其中 $B = \frac{h \cdot s}{k_S}$

# Ref

-  黄阿童学长的理论支持（特别鸣谢！）
-  《大型铸件凝固进程的数字模拟》 郭可讱
